{"ast":null,"code":"import _objectSpread from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import{Button,Input,Radio,Slider,Switch}from'antd';import React,{useEffect,useState}from'react';import styled from'styled-components';import{useFeeDiscountKeys,useLocallyStoredFeeDiscountKey,useMarket,useMarkPrice,useSelectedBaseCurrencyAccount,useSelectedBaseCurrencyBalances,useSelectedOpenOrdersAccount,useSelectedQuoteCurrencyAccount,useSelectedQuoteCurrencyBalances}from'../utils/markets';import{useWallet}from'../utils/wallet';import{notify}from'../utils/notifications';import{floorToDecimal,getDecimalCount,roundToDecimal}from'../utils/utils';import{useSendConnection}from'../utils/connection';import FloatingElement from'./layout/FloatingElement';import{getUnixTs,placeOrder}from'../utils/send';import{refreshCache}from'../utils/fetch-loop';import tuple from'immutable-tuple';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SellButton=styled(Button)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin: 20px 0px 0px 0px;\\n  background: #f23b69;\\n  border-color: #f23b69;\\n\"])));var BuyButton=styled(Button)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin: 20px 0px 0px 0px;\\n  background: #02bf76;\\n  border-color: #02bf76;\\n\"])));var sliderMarks={0:'0%',25:'25%',50:'50%',75:'75%',100:'100%'};export default function TradeForm(_ref){var style=_ref.style,setChangeOrderRef=_ref.setChangeOrderRef;var _useState=useState('buy'),_useState2=_slicedToArray(_useState,2),side=_useState2[0],setSide=_useState2[1];var _useMarket=useMarket(),baseCurrency=_useMarket.baseCurrency,quoteCurrency=_useMarket.quoteCurrency,market=_useMarket.market;var baseCurrencyBalances=useSelectedBaseCurrencyBalances();var quoteCurrencyBalances=useSelectedQuoteCurrencyBalances();var baseCurrencyAccount=useSelectedBaseCurrencyAccount();var quoteCurrencyAccount=useSelectedQuoteCurrencyAccount();var openOrdersAccount=useSelectedOpenOrdersAccount(true);var _useWallet=useWallet(),wallet=_useWallet.wallet,connected=_useWallet.connected;var sendConnection=useSendConnection();var markPrice=useMarkPrice();useFeeDiscountKeys();var _useLocallyStoredFeeD=useLocallyStoredFeeDiscountKey(),feeDiscountKey=_useLocallyStoredFeeD.storedFeeDiscountKey;var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),postOnly=_useState4[0],setPostOnly=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),ioc=_useState6[0],setIoc=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),baseSize=_useState8[0],setBaseSize=_useState8[1];var _useState9=useState(undefined),_useState10=_slicedToArray(_useState9,2),quoteSize=_useState10[0],setQuoteSize=_useState10[1];var _useState11=useState(undefined),_useState12=_slicedToArray(_useState11,2),price=_useState12[0],setPrice=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),submitting=_useState14[0],setSubmitting=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),sizeFraction=_useState16[0],setSizeFraction=_useState16[1];var availableQuote=openOrdersAccount&&market?market.quoteSplSizeToNumber(openOrdersAccount.quoteTokenFree):0;var quoteBalance=(quoteCurrencyBalances||0)+(availableQuote||0);var baseBalance=baseCurrencyBalances||0;var sizeDecimalCount=(market===null||market===void 0?void 0:market.minOrderSize)&&getDecimalCount(market.minOrderSize);var priceDecimalCount=(market===null||market===void 0?void 0:market.tickSize)&&getDecimalCount(market.tickSize);var publicKey=wallet===null||wallet===void 0?void 0:wallet.publicKey;useEffect(function(){setChangeOrderRef&&setChangeOrderRef(doChangeOrder);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[setChangeOrderRef]);useEffect(function(){baseSize&&price&&onSliderChange(sizeFraction);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[side]);useEffect(function(){updateSizeFraction();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[price,baseSize]);useEffect(function(){var warmUpCache=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var startTime,endTime;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(!wallet||!publicKey||!market)){_context.next=4;break;}console.log(\"Skipping refreshing accounts\");return _context.abrupt(\"return\");case 4:startTime=getUnixTs();console.log(\"Refreshing accounts for \".concat(market.address));_context.next=8;return market===null||market===void 0?void 0:market.findOpenOrdersAccountsForOwner(sendConnection,publicKey);case 8:_context.next=10;return market===null||market===void 0?void 0:market.findBestFeeDiscountKey(sendConnection,publicKey);case 10:endTime=getUnixTs();console.log(\"Finished refreshing accounts for \".concat(market.address,\" after \").concat(endTime-startTime));_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log(\"Encountered error when refreshing trading accounts: \".concat(_context.t0));case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function warmUpCache(){return _ref2.apply(this,arguments);};}();warmUpCache();var id=setInterval(warmUpCache,30000);return function(){return clearInterval(id);};},[market,sendConnection,wallet,publicKey]);var onSetBaseSize=function onSetBaseSize(baseSize){setBaseSize(baseSize);if(!baseSize){setQuoteSize(undefined);return;}var usePrice=price||markPrice;if(!usePrice){setQuoteSize(undefined);return;}var rawQuoteSize=baseSize*usePrice;var quoteSize=baseSize&&roundToDecimal(rawQuoteSize,sizeDecimalCount);setQuoteSize(quoteSize);};var onSetQuoteSize=function onSetQuoteSize(quoteSize){setQuoteSize(quoteSize);if(!quoteSize){setBaseSize(undefined);return;}var usePrice=price||markPrice;if(!usePrice){setBaseSize(undefined);return;}var rawBaseSize=quoteSize/usePrice;var baseSize=quoteSize&&roundToDecimal(rawBaseSize,sizeDecimalCount);setBaseSize(baseSize);};var doChangeOrder=function doChangeOrder(_ref3){var size=_ref3.size,price=_ref3.price;var formattedSize=size&&roundToDecimal(size,sizeDecimalCount);var formattedPrice=price&&roundToDecimal(price,priceDecimalCount);formattedSize&&onSetBaseSize(formattedSize);formattedPrice&&setPrice(formattedPrice);};var updateSizeFraction=function updateSizeFraction(){var rawMaxSize=side==='buy'?quoteBalance/(price||markPrice||1):baseBalance;var maxSize=floorToDecimal(rawMaxSize,sizeDecimalCount);var sizeFraction=Math.min((baseSize||0)/maxSize*100,100);setSizeFraction(sizeFraction);};var onSliderChange=function onSliderChange(value){if(!price&&markPrice){var formattedMarkPrice=priceDecimalCount?markPrice.toFixed(priceDecimalCount):markPrice;setPrice(typeof formattedMarkPrice==='number'?formattedMarkPrice:parseFloat(formattedMarkPrice));}var newSize;if(side==='buy'){if(price||markPrice){newSize=quoteBalance/(price||markPrice||1)*value/100;}}else{newSize=baseBalance*value/100;}// round down to minOrderSize increment\nvar formatted=floorToDecimal(newSize,sizeDecimalCount);onSetBaseSize(formatted);};var postOnChange=function postOnChange(checked){if(checked){setIoc(false);}setPostOnly(checked);};var iocOnChange=function iocOnChange(checked){if(checked){setPostOnly(false);}setIoc(checked);};function onSubmit(){return _onSubmit.apply(this,arguments);}function _onSubmit(){_onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(price){_context2.next=6;break;}console.warn('Missing price');notify({message:'Missing price',type:'error'});return _context2.abrupt(\"return\");case 6:if(baseSize){_context2.next=10;break;}console.warn('Missing size');notify({message:'Missing size',type:'error'});return _context2.abrupt(\"return\");case 10:setSubmitting(true);_context2.prev=11;if(wallet){_context2.next=14;break;}return _context2.abrupt(\"return\",null);case 14:_context2.next=16;return placeOrder({side:side,price:price,size:baseSize,orderType:ioc?'ioc':postOnly?'postOnly':'limit',market:market,connection:sendConnection,wallet:wallet,baseCurrencyAccount:baseCurrencyAccount===null||baseCurrencyAccount===void 0?void 0:baseCurrencyAccount.pubkey,quoteCurrencyAccount:quoteCurrencyAccount===null||quoteCurrencyAccount===void 0?void 0:quoteCurrencyAccount.pubkey,feeDiscountPubkey:feeDiscountKey});case 16:refreshCache(tuple('getTokenAccounts',wallet,connected));setPrice(undefined);onSetBaseSize(undefined);_context2.next=25;break;case 21:_context2.prev=21;_context2.t0=_context2[\"catch\"](11);console.warn(_context2.t0);notify({message:'Error placing order',description:_context2.t0.message,type:'error'});case 25:_context2.prev=25;setSubmitting(false);return _context2.finish(25);case 28:case\"end\":return _context2.stop();}}},_callee2,null,[[11,21,25,28]]);}));return _onSubmit.apply(this,arguments);}return/*#__PURE__*/_jsxs(FloatingElement,{style:_objectSpread({display:'flex',flexDirection:'column'},style),children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsxs(Radio.Group,{onChange:function onChange(e){return setSide(e.target.value);},value:side,buttonStyle:\"solid\",style:{marginBottom:8,width:'100%'},children:[/*#__PURE__*/_jsx(Radio.Button,{value:\"buy\",style:{width:'50%',textAlign:'center',background:side==='buy'?'#02bf76':'',borderColor:side==='buy'?'#02bf76':''},children:\"BUY\"}),/*#__PURE__*/_jsx(Radio.Button,{value:\"sell\",style:{width:'50%',textAlign:'center',background:side==='sell'?'#F23B69':'',borderColor:side==='sell'?'#F23B69':''},children:\"SELL\"})]}),/*#__PURE__*/_jsx(Input,{style:{textAlign:'right',paddingBottom:8},addonBefore:/*#__PURE__*/_jsx(\"div\",{style:{width:'30px'},children:\"Price\"}),suffix:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:10,opacity:0.5},children:quoteCurrency}),value:price,type:\"number\",step:(market===null||market===void 0?void 0:market.tickSize)||1,onChange:function onChange(e){return setPrice(parseFloat(e.target.value));}}),/*#__PURE__*/_jsxs(Input.Group,{compact:true,style:{paddingBottom:8},children:[/*#__PURE__*/_jsx(Input,{style:{width:'calc(50% + 30px)',textAlign:'right'},addonBefore:/*#__PURE__*/_jsx(\"div\",{style:{width:'30px'},children:\"Size\"}),suffix:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:10,opacity:0.5},children:baseCurrency}),value:baseSize,type:\"number\",step:(market===null||market===void 0?void 0:market.minOrderSize)||1,onChange:function onChange(e){return onSetBaseSize(parseFloat(e.target.value));}}),/*#__PURE__*/_jsx(Input,{style:{width:'calc(50% - 30px)',textAlign:'right'},suffix:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:10,opacity:0.5},children:quoteCurrency}),value:quoteSize,type:\"number\",step:(market===null||market===void 0?void 0:market.minOrderSize)||1,onChange:function onChange(e){return onSetQuoteSize(parseFloat(e.target.value));}})]}),/*#__PURE__*/_jsx(Slider,{value:sizeFraction,tipFormatter:function tipFormatter(value){return\"\".concat(value,\"%\");},marks:sliderMarks,onChange:onSliderChange}),/*#__PURE__*/_jsxs(\"div\",{style:{paddingTop:18},children:['POST ',/*#__PURE__*/_jsx(Switch,{checked:postOnly,onChange:postOnChange,style:{marginRight:40}}),'IOC ',/*#__PURE__*/_jsx(Switch,{checked:ioc,onChange:iocOnChange})]})]}),side==='buy'?/*#__PURE__*/_jsxs(BuyButton,{disabled:!price||!baseSize,onClick:onSubmit,block:true,type:\"primary\",size:\"large\",loading:submitting,children:[\"Buy \",baseCurrency]}):/*#__PURE__*/_jsxs(SellButton,{disabled:!price||!baseSize,onClick:onSubmit,block:true,type:\"primary\",size:\"large\",loading:submitting,children:[\"Sell \",baseCurrency]})]});}","map":{"version":3,"sources":["/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/src/components/TradeForm.tsx"],"names":["Button","Input","Radio","Slider","Switch","React","useEffect","useState","styled","useFeeDiscountKeys","useLocallyStoredFeeDiscountKey","useMarket","useMarkPrice","useSelectedBaseCurrencyAccount","useSelectedBaseCurrencyBalances","useSelectedOpenOrdersAccount","useSelectedQuoteCurrencyAccount","useSelectedQuoteCurrencyBalances","useWallet","notify","floorToDecimal","getDecimalCount","roundToDecimal","useSendConnection","FloatingElement","getUnixTs","placeOrder","refreshCache","tuple","SellButton","BuyButton","sliderMarks","TradeForm","style","setChangeOrderRef","side","setSide","baseCurrency","quoteCurrency","market","baseCurrencyBalances","quoteCurrencyBalances","baseCurrencyAccount","quoteCurrencyAccount","openOrdersAccount","wallet","connected","sendConnection","markPrice","feeDiscountKey","storedFeeDiscountKey","postOnly","setPostOnly","ioc","setIoc","undefined","baseSize","setBaseSize","quoteSize","setQuoteSize","price","setPrice","submitting","setSubmitting","sizeFraction","setSizeFraction","availableQuote","quoteSplSizeToNumber","quoteTokenFree","quoteBalance","baseBalance","sizeDecimalCount","minOrderSize","priceDecimalCount","tickSize","publicKey","doChangeOrder","onSliderChange","updateSizeFraction","warmUpCache","console","log","startTime","address","findOpenOrdersAccountsForOwner","findBestFeeDiscountKey","endTime","id","setInterval","clearInterval","onSetBaseSize","usePrice","rawQuoteSize","onSetQuoteSize","rawBaseSize","size","formattedSize","formattedPrice","rawMaxSize","maxSize","Math","min","value","formattedMarkPrice","toFixed","parseFloat","newSize","formatted","postOnChange","checked","iocOnChange","onSubmit","warn","message","type","orderType","connection","pubkey","feeDiscountPubkey","description","display","flexDirection","flex","e","target","marginBottom","width","textAlign","background","borderColor","paddingBottom","fontSize","opacity","paddingTop","marginRight"],"mappings":"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","sourcesContent":["import {Button, Input, Radio, Slider, Switch} from 'antd';\nimport React, {useEffect, useState} from 'react';\nimport styled from 'styled-components';\nimport {\n  useFeeDiscountKeys,\n  useLocallyStoredFeeDiscountKey,\n  useMarket,\n  useMarkPrice,\n  useSelectedBaseCurrencyAccount,\n  useSelectedBaseCurrencyBalances,\n  useSelectedOpenOrdersAccount,\n  useSelectedQuoteCurrencyAccount,\n  useSelectedQuoteCurrencyBalances,\n} from '../utils/markets';\nimport {useWallet} from '../utils/wallet';\nimport {notify} from '../utils/notifications';\nimport {floorToDecimal, getDecimalCount, roundToDecimal,} from '../utils/utils';\nimport {useSendConnection} from '../utils/connection';\nimport FloatingElement from './layout/FloatingElement';\nimport {getUnixTs, placeOrder} from '../utils/send';\nimport {SwitchChangeEventHandler} from 'antd/es/switch';\nimport {refreshCache} from '../utils/fetch-loop';\nimport tuple from 'immutable-tuple';\n\nconst SellButton = styled(Button)`\n  margin: 20px 0px 0px 0px;\n  background: #f23b69;\n  border-color: #f23b69;\n`;\n\nconst BuyButton = styled(Button)`\n  margin: 20px 0px 0px 0px;\n  background: #02bf76;\n  border-color: #02bf76;\n`;\n\nconst sliderMarks = {\n  0: '0%',\n  25: '25%',\n  50: '50%',\n  75: '75%',\n  100: '100%',\n};\n\nexport default function TradeForm({\n  style,\n  setChangeOrderRef,\n}: {\n  style?: any;\n  setChangeOrderRef?: (\n    ref: ({ size, price }: { size?: number; price?: number }) => void,\n  ) => void;\n}) {\n  const [side, setSide] = useState<'buy' | 'sell'>('buy');\n  const { baseCurrency, quoteCurrency, market } = useMarket();\n  const baseCurrencyBalances = useSelectedBaseCurrencyBalances();\n  const quoteCurrencyBalances = useSelectedQuoteCurrencyBalances();\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\n  const openOrdersAccount = useSelectedOpenOrdersAccount(true);\n  const { wallet, connected } = useWallet();\n  const sendConnection = useSendConnection();\n  const markPrice = useMarkPrice();\n  useFeeDiscountKeys();\n  const {\n    storedFeeDiscountKey: feeDiscountKey,\n  } = useLocallyStoredFeeDiscountKey();\n\n  const [postOnly, setPostOnly] = useState(false);\n  const [ioc, setIoc] = useState(false);\n  const [baseSize, setBaseSize] = useState<number | undefined>(undefined);\n  const [quoteSize, setQuoteSize] = useState<number | undefined>(undefined);\n  const [price, setPrice] = useState<number | undefined>(undefined);\n  const [submitting, setSubmitting] = useState(false);\n  const [sizeFraction, setSizeFraction] = useState(0);\n\n  const availableQuote =\n    openOrdersAccount && market\n      ? market.quoteSplSizeToNumber(openOrdersAccount.quoteTokenFree)\n      : 0;\n\n  let quoteBalance = (quoteCurrencyBalances || 0) + (availableQuote || 0);\n  let baseBalance = baseCurrencyBalances || 0;\n  let sizeDecimalCount =\n    market?.minOrderSize && getDecimalCount(market.minOrderSize);\n  let priceDecimalCount = market?.tickSize && getDecimalCount(market.tickSize);\n\n  const publicKey = wallet?.publicKey;\n\n  useEffect(() => {\n    setChangeOrderRef && setChangeOrderRef(doChangeOrder);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [setChangeOrderRef]);\n\n  useEffect(() => {\n    baseSize && price && onSliderChange(sizeFraction);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [side]);\n\n  useEffect(() => {\n    updateSizeFraction();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [price, baseSize]);\n\n  useEffect(() => {\n    const warmUpCache = async () => {\n      try {\n        if (!wallet || !publicKey || !market) {\n          console.log(`Skipping refreshing accounts`);\n          return;\n        }\n        const startTime = getUnixTs();\n        console.log(`Refreshing accounts for ${market.address}`);\n        await market?.findOpenOrdersAccountsForOwner(sendConnection, publicKey);\n        await market?.findBestFeeDiscountKey(sendConnection, publicKey);\n        const endTime = getUnixTs();\n        console.log(\n          `Finished refreshing accounts for ${market.address} after ${\n            endTime - startTime\n          }`,\n        );\n      } catch (e) {\n        console.log(`Encountered error when refreshing trading accounts: ${e}`);\n      }\n    };\n    warmUpCache();\n    const id = setInterval(warmUpCache, 30_000);\n    return () => clearInterval(id);\n  }, [market, sendConnection, wallet, publicKey]);\n\n  const onSetBaseSize = (baseSize: number | undefined) => {\n    setBaseSize(baseSize);\n    if (!baseSize) {\n      setQuoteSize(undefined);\n      return;\n    }\n    let usePrice = price || markPrice;\n    if (!usePrice) {\n      setQuoteSize(undefined);\n      return;\n    }\n    const rawQuoteSize = baseSize * usePrice;\n    const quoteSize =\n      baseSize && roundToDecimal(rawQuoteSize, sizeDecimalCount);\n    setQuoteSize(quoteSize);\n  };\n\n  const onSetQuoteSize = (quoteSize: number | undefined) => {\n    setQuoteSize(quoteSize);\n    if (!quoteSize) {\n      setBaseSize(undefined);\n      return;\n    }\n    let usePrice = price || markPrice;\n    if (!usePrice) {\n      setBaseSize(undefined);\n      return;\n    }\n    const rawBaseSize = quoteSize / usePrice;\n    const baseSize = quoteSize && roundToDecimal(rawBaseSize, sizeDecimalCount);\n    setBaseSize(baseSize);\n  };\n\n  const doChangeOrder = ({\n    size,\n    price,\n  }: {\n    size?: number;\n    price?: number;\n  }) => {\n    const formattedSize = size && roundToDecimal(size, sizeDecimalCount);\n    const formattedPrice = price && roundToDecimal(price, priceDecimalCount);\n    formattedSize && onSetBaseSize(formattedSize);\n    formattedPrice && setPrice(formattedPrice);\n  };\n\n  const updateSizeFraction = () => {\n    const rawMaxSize =\n      side === 'buy' ? quoteBalance / (price || markPrice || 1) : baseBalance;\n    const maxSize = floorToDecimal(rawMaxSize, sizeDecimalCount);\n    const sizeFraction = Math.min(((baseSize || 0) / maxSize) * 100, 100);\n    setSizeFraction(sizeFraction);\n  };\n\n  const onSliderChange = (value) => {\n    if (!price && markPrice) {\n      let formattedMarkPrice: number | string = priceDecimalCount\n        ? markPrice.toFixed(priceDecimalCount)\n        : markPrice;\n      setPrice(\n        typeof formattedMarkPrice === 'number'\n          ? formattedMarkPrice\n          : parseFloat(formattedMarkPrice),\n      );\n    }\n\n    let newSize;\n    if (side === 'buy') {\n      if (price || markPrice) {\n        newSize = ((quoteBalance / (price || markPrice || 1)) * value) / 100;\n      }\n    } else {\n      newSize = (baseBalance * value) / 100;\n    }\n\n    // round down to minOrderSize increment\n    let formatted = floorToDecimal(newSize, sizeDecimalCount);\n\n    onSetBaseSize(formatted);\n  };\n\n  const postOnChange: SwitchChangeEventHandler = (checked) => {\n    if (checked) {\n      setIoc(false);\n    }\n    setPostOnly(checked);\n  };\n  const iocOnChange: SwitchChangeEventHandler = (checked) => {\n    if (checked) {\n      setPostOnly(false);\n    }\n    setIoc(checked);\n  };\n\n  async function onSubmit() {\n    if (!price) {\n      console.warn('Missing price');\n      notify({\n        message: 'Missing price',\n        type: 'error',\n      });\n      return;\n    } else if (!baseSize) {\n      console.warn('Missing size');\n      notify({\n        message: 'Missing size',\n        type: 'error',\n      });\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      if (!wallet) {\n        return null;\n      }\n\n      await placeOrder({\n        side,\n        price,\n        size: baseSize,\n        orderType: ioc ? 'ioc' : postOnly ? 'postOnly' : 'limit',\n        market,\n        connection: sendConnection,\n        wallet,\n        baseCurrencyAccount: baseCurrencyAccount?.pubkey,\n        quoteCurrencyAccount: quoteCurrencyAccount?.pubkey,\n        feeDiscountPubkey: feeDiscountKey,\n      });\n      refreshCache(tuple('getTokenAccounts', wallet, connected));\n      setPrice(undefined);\n      onSetBaseSize(undefined);\n    } catch (e) {\n      console.warn(e);\n      notify({\n        message: 'Error placing order',\n        description: e.message,\n        type: 'error',\n      });\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  return (\n    <FloatingElement\n      style={{ display: 'flex', flexDirection: 'column', ...style }}\n    >\n      <div style={{ flex: 1 }}>\n        <Radio.Group\n          onChange={(e) => setSide(e.target.value)}\n          value={side}\n          buttonStyle=\"solid\"\n          style={{\n            marginBottom: 8,\n            width: '100%',\n          }}\n        >\n          <Radio.Button\n            value=\"buy\"\n            style={{\n              width: '50%',\n              textAlign: 'center',\n              background: side === 'buy' ? '#02bf76' : '',\n              borderColor: side === 'buy' ? '#02bf76' : '',\n            }}\n          >\n            BUY\n          </Radio.Button>\n          <Radio.Button\n            value=\"sell\"\n            style={{\n              width: '50%',\n              textAlign: 'center',\n              background: side === 'sell' ? '#F23B69' : '',\n              borderColor: side === 'sell' ? '#F23B69' : '',\n            }}\n          >\n            SELL\n          </Radio.Button>\n        </Radio.Group>\n        <Input\n          style={{ textAlign: 'right', paddingBottom: 8 }}\n          addonBefore={<div style={{ width: '30px' }}>Price</div>}\n          suffix={\n            <span style={{ fontSize: 10, opacity: 0.5 }}>{quoteCurrency}</span>\n          }\n          value={price}\n          type=\"number\"\n          step={market?.tickSize || 1}\n          onChange={(e) => setPrice(parseFloat(e.target.value))}\n        />\n        <Input.Group compact style={{ paddingBottom: 8 }}>\n          <Input\n            style={{ width: 'calc(50% + 30px)', textAlign: 'right' }}\n            addonBefore={<div style={{ width: '30px' }}>Size</div>}\n            suffix={\n              <span style={{ fontSize: 10, opacity: 0.5 }}>{baseCurrency}</span>\n            }\n            value={baseSize}\n            type=\"number\"\n            step={market?.minOrderSize || 1}\n            onChange={(e) => onSetBaseSize(parseFloat(e.target.value))}\n          />\n          <Input\n            style={{ width: 'calc(50% - 30px)', textAlign: 'right' }}\n            suffix={\n              <span style={{ fontSize: 10, opacity: 0.5 }}>\n                {quoteCurrency}\n              </span>\n            }\n            value={quoteSize}\n            type=\"number\"\n            step={market?.minOrderSize || 1}\n            onChange={(e) => onSetQuoteSize(parseFloat(e.target.value))}\n          />\n        </Input.Group>\n        <Slider\n          value={sizeFraction}\n          tipFormatter={(value) => `${value}%`}\n          marks={sliderMarks}\n          onChange={onSliderChange}\n        />\n        <div style={{ paddingTop: 18 }}>\n          {'POST '}\n          <Switch\n            checked={postOnly}\n            onChange={postOnChange}\n            style={{ marginRight: 40 }}\n          />\n          {'IOC '}\n          <Switch checked={ioc} onChange={iocOnChange} />\n        </div>\n      </div>\n      {side === 'buy' ? (\n        <BuyButton\n          disabled={!price || !baseSize}\n          onClick={onSubmit}\n          block\n          type=\"primary\"\n          size=\"large\"\n          loading={submitting}\n        >\n          Buy {baseCurrency}\n        </BuyButton>\n      ) : (\n        <SellButton\n          disabled={!price || !baseSize}\n          onClick={onSubmit}\n          block\n          type=\"primary\"\n          size=\"large\"\n          loading={submitting}\n        >\n          Sell {baseCurrency}\n        </SellButton>\n      )}\n    </FloatingElement>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}