{"ast":null,"code":"import _slicedToArray from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useContext,useEffect,useState}from'react';import{useConnection}from'./connection';import{PublicKey}from'@solana/web3.js';import{NameRegistryState,getHashedName,getNameAccountKey,getTwitterRegistry}from'@solana/spl-name-service';import{TOKEN_PROGRAM_ID}from'@solana/spl-token';import{useLocalStorageState}from'./utils';import{jsx as _jsx}from\"react/jsx-runtime\";var ReferrerContext=/*#__PURE__*/React.createContext(null);export var ASSOCIATED_TOKEN_PROGRAM_ID=new PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');var USDC_MINT=new PublicKey('EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v');var USDT_MINT=new PublicKey('Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB');export function findAssociatedTokenAddress(_x,_x2){return _findAssociatedTokenAddress.apply(this,arguments);}// Address of the SOL TLD\nfunction _findAssociatedTokenAddress(){_findAssociatedTokenAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(walletAddress,tokenMintAddress){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return PublicKey.findProgramAddress([walletAddress.toBuffer(),TOKEN_PROGRAM_ID.toBuffer(),tokenMintAddress.toBuffer()],ASSOCIATED_TOKEN_PROGRAM_ID);case 2:return _context3.abrupt(\"return\",_context3.sent[0]);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return _findAssociatedTokenAddress.apply(this,arguments);}export var SOL_TLD_AUTHORITY=new PublicKey('58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx');export var getInputKey=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input){var hashed_input_name,inputDomainKey;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getHashedName(input);case 2:hashed_input_name=_context.sent;_context.next=5;return getNameAccountKey(hashed_input_name,undefined,SOL_TLD_AUTHORITY);case 5:inputDomainKey=_context.sent;return _context.abrupt(\"return\",{inputDomainKey:inputDomainKey,hashedInputName:hashed_input_name});case 7:case\"end\":return _context.stop();}}},_callee);}));return function getInputKey(_x3){return _ref.apply(this,arguments);};}();export var useFeesAccountsFromRefCode=function useFeesAccountsFromRefCode(refCode){var connection=useConnection();var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),usdc=_useState2[0],setUsdc=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),usdt=_useState4[0],setUsdt=_useState4[1];useEffect(function(){var fn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var usdcAddress,usdtAddress,nameRegistryState,_yield$getInputKey,inputDomainKey,usdcAccountInfo,usdtAccountInfo;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:usdcAddress=undefined;usdtAddress=undefined;if(refCode){_context2.next=6;break;}setUsdc(process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS?new PublicKey(process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS):undefined);setUsdt(process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS?new PublicKey(process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS):undefined);return _context2.abrupt(\"return\");case 6:_context2.prev=6;if(!refCode.includes('.sol')){_context2.next=17;break;}_context2.next=10;return getInputKey(refCode.replace('.sol',''));case 10:_yield$getInputKey=_context2.sent;inputDomainKey=_yield$getInputKey.inputDomainKey;_context2.next=14;return NameRegistryState.retrieve(connection,inputDomainKey);case 14:nameRegistryState=_context2.sent;_context2.next=20;break;case 17:_context2.next=19;return getTwitterRegistry(connection,refCode);case 19:nameRegistryState=_context2.sent;case 20:_context2.next=22;return findAssociatedTokenAddress(nameRegistryState.owner,USDC_MINT);case 22:usdcAddress=_context2.sent;_context2.next=25;return findAssociatedTokenAddress(nameRegistryState.owner,USDT_MINT);case 25:usdtAddress=_context2.sent;_context2.next=28;return connection.getAccountInfo(usdcAddress);case 28:usdcAccountInfo=_context2.sent;_context2.next=31;return connection.getAccountInfo(usdtAddress);case 31:usdtAccountInfo=_context2.sent;if(!!(usdcAccountInfo===null||usdcAccountInfo===void 0?void 0:usdcAccountInfo.data))setUsdc(usdcAddress);if(!!(usdtAccountInfo===null||usdtAccountInfo===void 0?void 0:usdtAccountInfo.data))setUsdt(usdtAddress);_context2.next=39;break;case 36:_context2.prev=36;_context2.t0=_context2[\"catch\"](6);console.warn(\"Error getting refcode \".concat(_context2.t0));case 39:case\"end\":return _context2.stop();}}},_callee2,null,[[6,36]]);}));return function fn(){return _ref2.apply(this,arguments);};}();fn();},[connection,refCode]);return{usdcRef:usdc,usdtRef:usdt};};export var ReferrerProvider=function ReferrerProvider(_ref3){var children=_ref3.children;var allowRefLink=process.env.REACT_APP_ALLOW_REF_LINK==='true';var _useLocalStorageState=useLocalStorageState('refCode'),_useLocalStorageState2=_slicedToArray(_useLocalStorageState,2),refCode=_useLocalStorageState2[0],setRefCode=_useLocalStorageState2[1];var _useFeesAccountsFromR=useFeesAccountsFromRefCode(allowRefLink?refCode:undefined),usdcRef=_useFeesAccountsFromR.usdcRef,usdtRef=_useFeesAccountsFromR.usdtRef;useEffect(function(){if(!allowRefLink)setRefCode(null);},[allowRefLink,setRefCode]);return/*#__PURE__*/_jsx(ReferrerContext.Provider,{value:{usdcRef:usdcRef,usdtRef:usdtRef,setRefCode:setRefCode,refCode:refCode,allowRefLink:allowRefLink},children:children});};export var useReferrer=function useReferrer(){var context=useContext(ReferrerContext);if(!context)throw new Error('Missing referrer context');return{usdcRef:context.usdcRef,usdtRef:context.usdtRef,setRefCode:context.setRefCode,refCode:context.refCode,allowRefLink:context.allowRefLink};};","map":{"version":3,"sources":["/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/src/utils/referrer.tsx"],"names":["React","useContext","useEffect","useState","useConnection","PublicKey","NameRegistryState","getHashedName","getNameAccountKey","getTwitterRegistry","TOKEN_PROGRAM_ID","useLocalStorageState","ReferrerContext","createContext","ASSOCIATED_TOKEN_PROGRAM_ID","USDC_MINT","USDT_MINT","findAssociatedTokenAddress","walletAddress","tokenMintAddress","findProgramAddress","toBuffer","SOL_TLD_AUTHORITY","getInputKey","input","hashed_input_name","undefined","inputDomainKey","hashedInputName","useFeesAccountsFromRefCode","refCode","connection","usdc","setUsdc","usdt","setUsdt","fn","usdcAddress","usdtAddress","process","env","REACT_APP_USDC_REFERRAL_FEES_ADDRESS","REACT_APP_USDT_REFERRAL_FEES_ADDRESS","includes","replace","retrieve","nameRegistryState","owner","getAccountInfo","usdcAccountInfo","usdtAccountInfo","data","console","warn","usdcRef","usdtRef","ReferrerProvider","children","allowRefLink","REACT_APP_ALLOW_REF_LINK","setRefCode","useReferrer","context","Error"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { useConnection } from './connection';\nimport { PublicKey } from '@solana/web3.js';\nimport {\n  NameRegistryState,\n  getHashedName,\n  getNameAccountKey,\n  getTwitterRegistry,\n} from '@solana/spl-name-service';\nimport { TOKEN_PROGRAM_ID } from '@solana/spl-token';\nimport { useLocalStorageState } from './utils';\n\ninterface ReferrerContextValues {\n  usdcRef: PublicKey | undefined;\n  usdtRef: PublicKey | undefined;\n  setRefCode: (arg: any) => void;\n  refCode: string | undefined;\n  allowRefLink: boolean;\n}\n\nconst ReferrerContext: React.Context<null | ReferrerContextValues> = React.createContext<null | ReferrerContextValues>(\n  null,\n);\n\nexport const ASSOCIATED_TOKEN_PROGRAM_ID: PublicKey = new PublicKey(\n  'ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL',\n);\n\nconst USDC_MINT = new PublicKey('EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v');\nconst USDT_MINT = new PublicKey('Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB');\n\nexport async function findAssociatedTokenAddress(\n  walletAddress: PublicKey,\n  tokenMintAddress: PublicKey,\n): Promise<PublicKey> {\n  return (\n    await PublicKey.findProgramAddress(\n      [\n        walletAddress.toBuffer(),\n        TOKEN_PROGRAM_ID.toBuffer(),\n        tokenMintAddress.toBuffer(),\n      ],\n      ASSOCIATED_TOKEN_PROGRAM_ID,\n    )\n  )[0];\n}\n\n// Address of the SOL TLD\nexport const SOL_TLD_AUTHORITY = new PublicKey(\n  '58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx',\n);\n\nexport const getInputKey = async (input: string) => {\n  let hashed_input_name = await getHashedName(input);\n  let inputDomainKey = await getNameAccountKey(\n    hashed_input_name,\n    undefined,\n    SOL_TLD_AUTHORITY,\n  );\n  return { inputDomainKey: inputDomainKey, hashedInputName: hashed_input_name };\n};\n\nexport const useFeesAccountsFromRefCode = (refCode: string | undefined) => {\n  const connection = useConnection();\n  const [usdc, setUsdc] = useState<PublicKey | undefined>(undefined);\n  const [usdt, setUsdt] = useState<PublicKey | undefined>(undefined);\n\n  useEffect(() => {\n    const fn = async () => {\n      let usdcAddress: undefined | PublicKey = undefined;\n      let usdtAddress: undefined | PublicKey = undefined;\n      if (!refCode) {\n        setUsdc(\n          process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS\n            ? new PublicKey(process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS)\n            : undefined,\n        );\n        setUsdt(\n          process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS\n            ? new PublicKey(process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS)\n            : undefined,\n        );\n        return;\n      }\n      try {\n        let nameRegistryState: NameRegistryState;\n        if (refCode.includes('.sol')) {\n          const { inputDomainKey } = await getInputKey(\n            refCode.replace('.sol', ''),\n          );\n          nameRegistryState = await NameRegistryState.retrieve(\n            connection,\n            inputDomainKey,\n          );\n        } else {\n          nameRegistryState = await getTwitterRegistry(connection, refCode);\n        }\n        usdcAddress = await findAssociatedTokenAddress(\n          nameRegistryState.owner,\n          USDC_MINT,\n        );\n        usdtAddress = await findAssociatedTokenAddress(\n          nameRegistryState.owner,\n          USDT_MINT,\n        );\n        const usdcAccountInfo = await connection.getAccountInfo(usdcAddress);\n        const usdtAccountInfo = await connection.getAccountInfo(usdtAddress);\n        if (!!usdcAccountInfo?.data) setUsdc(usdcAddress);\n        if (!!usdtAccountInfo?.data) setUsdt(usdtAddress);\n      } catch (err) {\n        console.warn(`Error getting refcode ${err}`);\n      }\n    };\n    fn();\n  }, [connection, refCode]);\n  return { usdcRef: usdc, usdtRef: usdt };\n};\n\nexport const ReferrerProvider = ({ children }) => {\n  const allowRefLink = process.env.REACT_APP_ALLOW_REF_LINK === 'true';\n  const [refCode, setRefCode] = useLocalStorageState('refCode');\n  const { usdcRef, usdtRef } = useFeesAccountsFromRefCode(\n    allowRefLink ? refCode : undefined,\n  );\n  useEffect(() => {\n    if (!allowRefLink) setRefCode(null);\n  }, [allowRefLink, setRefCode]);\n  return (\n    <ReferrerContext.Provider\n      value={{ usdcRef, usdtRef, setRefCode, refCode, allowRefLink }}\n    >\n      {children}\n    </ReferrerContext.Provider>\n  );\n};\n\nexport const useReferrer = () => {\n  const context = useContext(ReferrerContext);\n  if (!context) throw new Error('Missing referrer context');\n  return {\n    usdcRef: context.usdcRef,\n    usdtRef: context.usdtRef,\n    setRefCode: context.setRefCode,\n    refCode: context.refCode,\n    allowRefLink: context.allowRefLink,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}