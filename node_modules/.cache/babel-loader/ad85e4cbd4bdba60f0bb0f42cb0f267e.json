{"ast":null,"code":"import _slicedToArray from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7;import{Col,Row}from'antd';import React,{useRef,useEffect,useState}from'react';import styled,{css}from'styled-components';import{useMarket,useOrderbook,useMarkPrice}from'../utils/markets';import{isEqual,getDecimalCount}from'../utils/utils';import{useInterval}from'../utils/useInterval';import FloatingElement from'./layout/FloatingElement';import usePrevious from'../utils/usePrevious';import{ArrowUpOutlined,ArrowDownOutlined}from'@ant-design/icons';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Title=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  color: rgba(255, 255, 255, 1);\\n\"])));var SizeTitle=styled(Row)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  padding: 20px 0 14px;\\n  color: #434a59;\\n\"])));var MarkPriceTitle=styled(Row)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  padding: 20px 0 14px;\\n  font-weight: 700;\\n\"])));var Line=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  text-align: right;\\n  float: right;\\n  height: 100%;\\n  \",\"\\n  \",\"\\n\"])),function(props){return props['data-width']&&css(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n      width: \",\";\\n    \"])),props['data-width']);},function(props){return props['data-bgcolor']&&css(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n      background-color: \",\";\\n    \"])),props['data-bgcolor']);});var Price=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  right: 5px;\\n  color: white;\\n\"])));export default function Orderbook(_ref){var smallScreen=_ref.smallScreen,_ref$depth=_ref.depth,depth=_ref$depth===void 0?7:_ref$depth,onPrice=_ref.onPrice,onSize=_ref.onSize;var markPrice=useMarkPrice();var _useOrderbook=useOrderbook(),_useOrderbook2=_slicedToArray(_useOrderbook,1),orderbook=_useOrderbook2[0];var _useMarket=useMarket(),baseCurrency=_useMarket.baseCurrency,quoteCurrency=_useMarket.quoteCurrency;var currentOrderbookData=useRef(null);var lastOrderbookData=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),orderbookData=_useState2[0],setOrderbookData=_useState2[1];useInterval(function(){if(!currentOrderbookData.current||JSON.stringify(currentOrderbookData.current)!==JSON.stringify(lastOrderbookData.current)){var bids=(orderbook===null||orderbook===void 0?void 0:orderbook.bids)||[];var asks=(orderbook===null||orderbook===void 0?void 0:orderbook.asks)||[];var sum=function sum(total,_ref2,index){var _ref3=_slicedToArray(_ref2,2),size=_ref3[1];return index<depth?total+size:total;};var totalSize=bids.reduce(sum,0)+asks.reduce(sum,0);var bidsToDisplay=getCumulativeOrderbookSide(bids,totalSize,false);var asksToDisplay=getCumulativeOrderbookSide(asks,totalSize,true);currentOrderbookData.current={bids:orderbook===null||orderbook===void 0?void 0:orderbook.bids,asks:orderbook===null||orderbook===void 0?void 0:orderbook.asks};setOrderbookData({bids:bidsToDisplay,asks:asksToDisplay});}},250);useEffect(function(){lastOrderbookData.current={bids:orderbook===null||orderbook===void 0?void 0:orderbook.bids,asks:orderbook===null||orderbook===void 0?void 0:orderbook.asks};},[orderbook]);function getCumulativeOrderbookSide(orders,totalSize){var backwards=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var cumulative=orders.slice(0,depth).reduce(function(cumulative,_ref4,i){var _cumulative;var _ref5=_slicedToArray(_ref4,2),price=_ref5[0],size=_ref5[1];var cumulativeSize=(((_cumulative=cumulative[i-1])===null||_cumulative===void 0?void 0:_cumulative.cumulativeSize)||0)+size;cumulative.push({price:price,size:size,cumulativeSize:cumulativeSize,sizePercent:Math.round(cumulativeSize/(totalSize||1)*100)});return cumulative;},[]);if(backwards){cumulative=cumulative.reverse();}return cumulative;}return/*#__PURE__*/_jsxs(FloatingElement,{style:smallScreen?{flex:1}:{height:'500px',overflow:'hidden'},children:[/*#__PURE__*/_jsx(Title,{children:\"Orderbook\"}),/*#__PURE__*/_jsxs(SizeTitle,{children:[/*#__PURE__*/_jsxs(Col,{span:12,style:{textAlign:'left'},children:[\"Size (\",baseCurrency,\")\"]}),/*#__PURE__*/_jsxs(Col,{span:12,style:{textAlign:'right'},children:[\"Price (\",quoteCurrency,\")\"]})]}),orderbookData===null||orderbookData===void 0?void 0:orderbookData.asks.map(function(_ref6){var price=_ref6.price,size=_ref6.size,sizePercent=_ref6.sizePercent;return/*#__PURE__*/_jsx(OrderbookRow,{price:price,size:size,side:'sell',sizePercent:sizePercent,onPriceClick:function onPriceClick(){return onPrice(price);},onSizeClick:function onSizeClick(){return onSize(size);}},price+'');}),/*#__PURE__*/_jsx(MarkPriceComponent,{markPrice:markPrice}),orderbookData===null||orderbookData===void 0?void 0:orderbookData.bids.map(function(_ref7){var price=_ref7.price,size=_ref7.size,sizePercent=_ref7.sizePercent;return/*#__PURE__*/_jsx(OrderbookRow,{price:price,size:size,side:'buy',sizePercent:sizePercent,onPriceClick:function onPriceClick(){return onPrice(price);},onSizeClick:function onSizeClick(){return onSize(size);}},price+'');})]});}var OrderbookRow=/*#__PURE__*/React.memo(function(_ref8){var side=_ref8.side,price=_ref8.price,size=_ref8.size,sizePercent=_ref8.sizePercent,onSizeClick=_ref8.onSizeClick,onPriceClick=_ref8.onPriceClick;var element=useRef();var _useMarket2=useMarket(),market=_useMarket2.market;useEffect(function(){var _element$current,_element$current2;// eslint-disable-next-line\n!((_element$current=element.current)===null||_element$current===void 0?void 0:_element$current.classList.contains('flash'))&&((_element$current2=element.current)===null||_element$current2===void 0?void 0:_element$current2.classList.add('flash'));var id=setTimeout(function(){var _element$current3,_element$current4;return((_element$current3=element.current)===null||_element$current3===void 0?void 0:_element$current3.classList.contains('flash'))&&((_element$current4=element.current)===null||_element$current4===void 0?void 0:_element$current4.classList.remove('flash'));},250);return function(){return clearTimeout(id);};},[price,size]);var formattedSize=(market===null||market===void 0?void 0:market.minOrderSize)&&!isNaN(size)?Number(size).toFixed(getDecimalCount(market.minOrderSize)+1):size;var formattedPrice=(market===null||market===void 0?void 0:market.tickSize)&&!isNaN(price)?Number(price).toFixed(getDecimalCount(market.tickSize)+1):price;return/*#__PURE__*/_jsxs(Row,{ref:element,style:{marginBottom:1},onClick:onSizeClick,children:[/*#__PURE__*/_jsx(Col,{span:12,style:{textAlign:'left'},children:formattedSize}),/*#__PURE__*/_jsxs(Col,{span:12,style:{textAlign:'right'},children:[/*#__PURE__*/_jsx(Line,{\"data-width\":sizePercent+'%',\"data-bgcolor\":side==='buy'?'rgba(65, 199, 122, 0.6)':'rgba(242, 60, 105, 0.6)'}),/*#__PURE__*/_jsx(Price,{onClick:onPriceClick,children:formattedPrice})]})]});},function(prevProps,nextProps){return isEqual(prevProps,nextProps,['price','size','sizePercent']);});var MarkPriceComponent=/*#__PURE__*/React.memo(function(_ref9){var markPrice=_ref9.markPrice;var _useMarket3=useMarket(),market=_useMarket3.market;var previousMarkPrice=usePrevious(markPrice);var markPriceColor=markPrice>previousMarkPrice?'#41C77A':markPrice<previousMarkPrice?'#F23B69':'white';var formattedMarkPrice=markPrice&&(market===null||market===void 0?void 0:market.tickSize)&&markPrice.toFixed(getDecimalCount(market.tickSize));return/*#__PURE__*/_jsx(MarkPriceTitle,{justify:\"center\",children:/*#__PURE__*/_jsxs(Col,{style:{color:markPriceColor},children:[markPrice>previousMarkPrice&&/*#__PURE__*/_jsx(ArrowUpOutlined,{style:{marginRight:5}}),markPrice<previousMarkPrice&&/*#__PURE__*/_jsx(ArrowDownOutlined,{style:{marginRight:5}}),formattedMarkPrice||'----']})});},function(prevProps,nextProps){return isEqual(prevProps,nextProps,['markPrice']);});","map":{"version":3,"sources":["/Users/cesarhugo.barzano/Desktop/CesarCorp/coins/serum-dex-ui/src/components/Orderbook.jsx"],"names":["Col","Row","React","useRef","useEffect","useState","styled","css","useMarket","useOrderbook","useMarkPrice","isEqual","getDecimalCount","useInterval","FloatingElement","usePrevious","ArrowUpOutlined","ArrowDownOutlined","Title","div","SizeTitle","MarkPriceTitle","Line","props","Price","Orderbook","smallScreen","depth","onPrice","onSize","markPrice","orderbook","baseCurrency","quoteCurrency","currentOrderbookData","lastOrderbookData","orderbookData","setOrderbookData","current","JSON","stringify","bids","asks","sum","total","index","size","totalSize","reduce","bidsToDisplay","getCumulativeOrderbookSide","asksToDisplay","orders","backwards","cumulative","slice","i","price","cumulativeSize","push","sizePercent","Math","round","reverse","flex","height","overflow","textAlign","map","OrderbookRow","memo","side","onSizeClick","onPriceClick","element","market","classList","contains","add","id","setTimeout","remove","clearTimeout","formattedSize","minOrderSize","isNaN","Number","toFixed","formattedPrice","tickSize","marginBottom","prevProps","nextProps","MarkPriceComponent","previousMarkPrice","markPriceColor","formattedMarkPrice","color","marginRight"],"mappings":"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","sourcesContent":["import { Col, Row } from 'antd';\nimport React, { useRef, useEffect, useState } from 'react';\nimport styled, { css } from 'styled-components';\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\nimport { isEqual, getDecimalCount } from '../utils/utils';\nimport { useInterval } from '../utils/useInterval';\nimport FloatingElement from './layout/FloatingElement';\nimport usePrevious from '../utils/usePrevious';\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\n\nconst Title = styled.div`\n  color: rgba(255, 255, 255, 1);\n`;\n\nconst SizeTitle = styled(Row)`\n  padding: 20px 0 14px;\n  color: #434a59;\n`;\n\nconst MarkPriceTitle = styled(Row)`\n  padding: 20px 0 14px;\n  font-weight: 700;\n`;\n\nconst Line = styled.div`\n  text-align: right;\n  float: right;\n  height: 100%;\n  ${(props) =>\n    props['data-width'] &&\n    css`\n      width: ${props['data-width']};\n    `}\n  ${(props) =>\n    props['data-bgcolor'] &&\n    css`\n      background-color: ${props['data-bgcolor']};\n    `}\n`;\n\nconst Price = styled.div`\n  position: absolute;\n  right: 5px;\n  color: white;\n`;\n\nexport default function Orderbook({ smallScreen, depth = 7, onPrice, onSize }) {\n  const markPrice = useMarkPrice();\n  const [orderbook] = useOrderbook();\n  const { baseCurrency, quoteCurrency } = useMarket();\n\n  const currentOrderbookData = useRef(null);\n  const lastOrderbookData = useRef(null);\n\n  const [orderbookData, setOrderbookData] = useState(null);\n\n  useInterval(() => {\n    if (\n      !currentOrderbookData.current ||\n      JSON.stringify(currentOrderbookData.current) !==\n        JSON.stringify(lastOrderbookData.current)\n    ) {\n      let bids = orderbook?.bids || [];\n      let asks = orderbook?.asks || [];\n\n      let sum = (total, [, size], index) =>\n        index < depth ? total + size : total;\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\n\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\n\n      currentOrderbookData.current = {\n        bids: orderbook?.bids,\n        asks: orderbook?.asks,\n      };\n\n      setOrderbookData({ bids: bidsToDisplay, asks: asksToDisplay });\n    }\n  }, 250);\n\n  useEffect(() => {\n    lastOrderbookData.current = {\n      bids: orderbook?.bids,\n      asks: orderbook?.asks,\n    };\n  }, [orderbook]);\n\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\n    let cumulative = orders\n      .slice(0, depth)\n      .reduce((cumulative, [price, size], i) => {\n        const cumulativeSize = (cumulative[i - 1]?.cumulativeSize || 0) + size;\n        cumulative.push({\n          price,\n          size,\n          cumulativeSize,\n          sizePercent: Math.round((cumulativeSize / (totalSize || 1)) * 100),\n        });\n        return cumulative;\n      }, []);\n    if (backwards) {\n      cumulative = cumulative.reverse();\n    }\n    return cumulative;\n  }\n\n  return (\n    <FloatingElement\n      style={\n        smallScreen ? { flex: 1 } : { height: '500px', overflow: 'hidden' }\n      }\n    >\n      <Title>Orderbook</Title>\n      <SizeTitle>\n        <Col span={12} style={{ textAlign: 'left' }}>\n          Size ({baseCurrency})\n        </Col>\n        <Col span={12} style={{ textAlign: 'right' }}>\n          Price ({quoteCurrency})\n        </Col>\n      </SizeTitle>\n      {orderbookData?.asks.map(({ price, size, sizePercent }) => (\n        <OrderbookRow\n          key={price + ''}\n          price={price}\n          size={size}\n          side={'sell'}\n          sizePercent={sizePercent}\n          onPriceClick={() => onPrice(price)}\n          onSizeClick={() => onSize(size)}\n        />\n      ))}\n      <MarkPriceComponent markPrice={markPrice} />\n      {orderbookData?.bids.map(({ price, size, sizePercent }) => (\n        <OrderbookRow\n          key={price + ''}\n          price={price}\n          size={size}\n          side={'buy'}\n          sizePercent={sizePercent}\n          onPriceClick={() => onPrice(price)}\n          onSizeClick={() => onSize(size)}\n        />\n      ))}\n    </FloatingElement>\n  );\n}\n\nconst OrderbookRow = React.memo(\n  ({ side, price, size, sizePercent, onSizeClick, onPriceClick }) => {\n    const element = useRef();\n\n    const { market } = useMarket();\n\n    useEffect(() => {\n      // eslint-disable-next-line\n      !element.current?.classList.contains('flash') &&\n        element.current?.classList.add('flash');\n      const id = setTimeout(\n        () =>\n          element.current?.classList.contains('flash') &&\n          element.current?.classList.remove('flash'),\n        250,\n      );\n      return () => clearTimeout(id);\n    }, [price, size]);\n\n    let formattedSize =\n      market?.minOrderSize && !isNaN(size)\n        ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1)\n        : size;\n\n    let formattedPrice =\n      market?.tickSize && !isNaN(price)\n        ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1)\n        : price;\n\n    return (\n      <Row ref={element} style={{ marginBottom: 1 }} onClick={onSizeClick}>\n        <Col span={12} style={{ textAlign: 'left' }}>\n          {formattedSize}\n        </Col>\n        <Col span={12} style={{ textAlign: 'right' }}>\n          <Line\n            data-width={sizePercent + '%'}\n            data-bgcolor={\n              side === 'buy'\n                ? 'rgba(65, 199, 122, 0.6)'\n                : 'rgba(242, 60, 105, 0.6)'\n            }\n          />\n          <Price onClick={onPriceClick}>{formattedPrice}</Price>\n        </Col>\n      </Row>\n    );\n  },\n  (prevProps, nextProps) =>\n    isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']),\n);\n\nconst MarkPriceComponent = React.memo(\n  ({ markPrice }) => {\n    const { market } = useMarket();\n    const previousMarkPrice = usePrevious(markPrice);\n\n    let markPriceColor =\n      markPrice > previousMarkPrice\n        ? '#41C77A'\n        : markPrice < previousMarkPrice\n        ? '#F23B69'\n        : 'white';\n\n    let formattedMarkPrice =\n      markPrice &&\n      market?.tickSize &&\n      markPrice.toFixed(getDecimalCount(market.tickSize));\n\n    return (\n      <MarkPriceTitle justify=\"center\">\n        <Col style={{ color: markPriceColor }}>\n          {markPrice > previousMarkPrice && (\n            <ArrowUpOutlined style={{ marginRight: 5 }} />\n          )}\n          {markPrice < previousMarkPrice && (\n            <ArrowDownOutlined style={{ marginRight: 5 }} />\n          )}\n          {formattedMarkPrice || '----'}\n        </Col>\n      </MarkPriceTitle>\n    );\n  },\n  (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']),\n);\n"]},"metadata":{},"sourceType":"module"}